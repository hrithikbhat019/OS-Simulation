<!DOCTYPE html>

{% load static %}
<head>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link href="{% static 'css/readerwriter.css' %}" rel="stylesheet" />
</head>

<body>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <div class="container-fluid">
    <center><h1>Reader-Writer Problem (Writer Preference)</u> </h1></center>
    <form onsubmit="return false">
      <p><br /></p>
      <h4>First user:  </h4>
      Read: <input type = "checkbox", name = "first">
      Write: <input type = "checkbox" name = "first"><br>
      <p style="font-size:10px"><br /><br /></p>
      <h4>Second user: </h4>
      Read: <input type = "checkbox", name = "second">
      Write: <input type = "checkbox" name = "second">
      <p style="font-size:10px"><br /><br /></p>
      <h4>Third user: </h4>
      Read: <input type = "checkbox", name = "third">
      Write: <input type = "checkbox" name = "third">



      <br /><br />
      <input type = "submit", name ="Go!", onclick="update()", class="btn btn-primary">
    </form>

    <button type = "button", id ="one", name = "one"> </button>
    <button type = "button", id ="two", name = "two"> </button>
    <button type = "button", id ="three", name = "three"> </button>


    <button type = "button", id ="lock", class ="btn btn-primary", name = "lock">Writer - : </button>

    <div>
      <form>
        <textarea id="doc" disabled="" >Writers write to the file here... </textarea>
      </form>
    </div>
    <script type = "text/javascript">
      var mutex =-1;
      function update()
      {
        var checkW =0;
        for(var i=0;i<7;i++)
        {
          if(i%2 != 0 && document.forms[0].elements[i].checked==true)
          {
            checkW=1;
          }
        }
        if(checkW==0)
        {
          mutex=-1;
          var change = document.getElementById("lock");
          change.innerHTML ="Writing Lock:"
        }

        for(var i=0;i<7;i++)
        {
          if(i%2 !=0 && document.forms[0].elements[i].checked == true && (mutex==(i-1)/2 || mutex==-1))
          {
            for(var j=0;j<7;j++)
            {
              if(j!=i/* && j%2 ==0*/)// important change made here
              {
                document.forms[0].elements[j].checked = false
              }
            }
          }
        }

        for(var i=0;i<7;i++)
        {
          document.getElementById("one").style.backgroundColor = '#FFFFFF';
          document.getElementById("two").style.backgroundColor = '#FFFFFF';
          document.getElementById("three").style.backgroundColor = '#FFFFFF';

        }

            if(document.forms[0].elements[0].checked == true)
            {
              document.getElementById("one").style.backgroundColor = '##8e44ad';
              mutex =-1;
            }
            if(document.forms[0].elements[2].checked == true)
            {
              document.getElementById("two").style.backgroundColor = '#8e44ad';
              mutex =-1;
            }
            if(document.forms[0].elements[4].checked == true)
            {
              document.getElementById("three").style.backgroundColor = '#8e44ad';
              mutex =-1;
            }


            if(document.forms[0].elements[1].checked == true)
            {
              document.getElementById("one").style.backgroundColor = '#f1c40f';
              var change = document.getElementById("lock");
              change.innerHTML ="Writer : 1"
              mutex =0;
            }
            if(document.forms[0].elements[3].checked == true)
            {
              document.getElementById("two").style.backgroundColor = '#f1c40f';
              var change = document.getElementById("lock");
              change.innerHTML ="Writer - : 2"
              mutex =1;
            }
            if(document.forms[0].elements[5].checked == true)
            {
              document.getElementById("three").style.backgroundColor = '#f1c40f';
              var change = document.getElementById("lock");
              change.innerHTML ="Writer - : 3"
              mutex =2;
            }

            console.log(mutex);
            if(mutex==-1)
            {
               document.getElementById("doc").disabled = true;
            }
            else
            {
                document.getElementById("doc").disabled = false;
            }
      }
    </script>

    <button type = "button" id="legend1"> </button>
    <p id="legendText1"> Not accessing -   </p>
    <button id="legend2" type = "button"> </button>
    <p id="legendText2"> Reading -  </p>
    <button  id="legend3" type = "button"> </button>
    <p id="legendText3" > Writing  - </p>
  </div>
</body>
