<!doctype html>
<html xmlns:https="http://www.w3.org/1999/xhtml">
<head>
    <title>RAG</title>

    <script type="text/javascript" src="http://visjs.org/dist/vis.js"></script>
    <link href="http://visjs.org/dist/vis-network.min.css" rel="stylesheet" type="text/css" />
    <link href="https://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

    <style>

        .custom{
            color: green;
            text-align: center;
            font-family: "Times New Roman";
            font-size: 30px;
        }
    </style>

</head>


<body>



<div class = "panel panel-primary" style="margin : 0.25cm 0.25cm 0.25cm 0.25cm;">

	        <div class="panel-heading" style="background-color: #8b0033">

	         <h1>Resource Allocation Graph</h1>

	          </div>

			<div class="panel-body">
<div class="row">

    <div class="col-md-5" >



    <h3>Note:</h3>
    <li>
        Index starts from 0

    </li>
    <li>
        Only for Single Instance Resources
    </li>
    <br>

<div class="row my-4">

    <div class="col-md-5">
        <input id="resource_no" type="text" placeholder=" Enter the no of Resources" class="form-control">
    </div>

    <div class="col-md-5">
        <input id="process_no" type="text" placeholder="Enter the no of processes" class="form-control">
    </div>

    <div class="col-md-2">
                                <button type="button" class="btn btn-primary" onclick="BuildFormField()">Save</button>

    </div>
</div>








    <div class="row">
      <div class="column" style=" float: left; width: 50%;">

          <form name="Hold">

            <div id="FormFields1" >

            </div>

         </form>

      </div>
      <div class="column" style="float: left; width: 50%">

          <form name="Request">

            <div id="FormFields2" >
            </div>

          </form>

      </div>
        <div class="container col-md-4">



        <button type="button" class="btn btn-primary center-block" onclick="startNetwork()" style="text-align: center;" >Save2</button>

        </div>


    </div>


    </div>

    <div class="col-md-7" >


<div id="mynetwork" style=" height:550px; border: 2px solid darkred"></div>
           <div id="demo" style="background-color: darkred; text-align: center; color: white"></div>

           </div>



</div>


	        </div>
			<div class="panel-footer">

	        </div>
		</div>









<script>

    function BuildFormField()
			{

                var $amount = Number(document.getElementById('resource_no').value);
				var
					$container = document.getElementById('FormFields1'),
					$item, $field, $i;


				$item = document.createElement('div');
				$item.innerHTML = ' Process Requesting Resources';
				$item.setAttribute("class","custom");
					$container.appendChild($item);


				for ($i = 0; $i < $amount; $i++) {
					$item = document.createElement('div');
					$item.style.margin = '10px';


                    $field = document.createElement('label');
                    $field.innerHTML = 'Resource '+$i;
					$item.appendChild($field);

					$field = document.createElement('input');
					$field.name = 'Design[' + $i + ']';
					$field.type = 'text';
                    $field.setAttribute("class","form-control");
					$item.appendChild($field);


					$container.appendChild($item);
				}
                var $container = document.getElementById('FormFields2');


				$item = document.createElement('div');
				$item.innerHTML = ' Process Holding Resources';
				$item.setAttribute("class","custom");
					$container.appendChild($item);


				for ($i = 0; $i < $amount; $i++) {
					$item = document.createElement('div');
					$item.style.margin = '10px';


                    $field = document.createElement('label');
                    $field.innerHTML = 'Resource '+$i;
					$item.appendChild($field);

					$field = document.createElement('input');
					$field.name = 'Design[' + $i + ']';
					$field.type = 'text';
                    $field.setAttribute("class","form-control");
					$item.appendChild($field);

					$container.appendChild($item);
				}
            }

</script>

<script type="text/javascript">

    var current_node, cycle=0;

    function AB(Edges, color, current) {

        if(cycle == 1)
            return;

        if(color[current] == 0){
            color[current] = 1;
            current_node = current;
        }
        else
        {
            if(current == current_node)
                cycle = 1;
            return;
        }

        var len = Edges[current].length;

        for(var i=0;i<len;i++){
            AB(Edges, color, Edges[current][i]);
            if(cycle == 1)
                break;
            i++;
        }

        return;
    }

    var nodeIds, shadowState, nodesArray, nodes, edgesArray, edges, network;

    function startNetwork() {
        // this list is kept to remove a random node.. we do not add node 1 here because it's used for changes
        nodeIds = [2, 3, 4, 5];

        shadowState = false;

        nodesArray = [];

         var i = 0;
            var res_no = Number(document.getElementById('resource_no').value);
            var pro_no = Number(document.getElementById('process_no').value);
            for (; i < pro_no; ) {
                var a = {id:i, label:"Process"+ i.toString(), shape: 'circle'};
                nodesArray.push(a);
                i++;
            }
            i=0;
            for (; i < res_no; ) {
                a = {id:pro_no+i, label:"Resource"+ i.toString(), shape: 'database'};
                nodesArray.push(a);
                i++;
            }

        nodes = new vis.DataSet(nodesArray);


        // create an array with edges
        var Edges = new Array(pro_no+res_no);
        for(i=0; i<pro_no+res_no;i++){
            Edges[i] = [];
        }
        edgesArray = [];
        var Hold_form = document.Hold;

            for (i=0; i < res_no; ) {
                var hold = Hold_form[i].value;
                for(var j=0; j< hold.length;)
                {
                    a = {from: hold[j], to:i + pro_no, arrows:'to'};
                    edgesArray.push(a);
                    Edges[i+pro_no].push(hold[j]);
                    j++;
                }
                i++;
            }

        var Request_form = document.Request;

            for (i=0; i < res_no; ) {
                var request = Request_form[i].value;
                for(var j=0; j< request.length;)
                {
                    a = {from: i + pro_no, to:request[j], arrows:'to'};
                    Edges[request[j]].push(i + pro_no);
                    edgesArray.push(a);
                    j++;
                }
                i++;
            }

        var color = new Array(pro_no+res_no);

            for(i=0; i<pro_no+res_no;i++){
            color[i] = 0;
        }

        for(i=0; i<pro_no+res_no;i++){
                if(Edges[i].length != 0)
                    AB(Edges, color,i);
        }


        edges = new vis.DataSet(edgesArray);

        // create a network
        var container = document.getElementById('mynetwork');
        var data = {
            nodes: nodes,
            edges: edges
        };
        var options = {

            edges: {
                font: {
                    size: 12
                     },
                widthConstraint: {
                    maximum: 100
                                }
                  },
            nodes: {
              shape: 'box',
              margin: 10,
              widthConstraint: {
                maximum: 200
                               }
                },
            physics: {
              enabled: false
            }
        };

        network = new vis.Network(container, data, options);

       var $container = document.getElementById('demo');

       if(cycle == 0){
           $container.innerHTML = 'Safe State'
       }
       else {
           $container.innerHTML = 'Dead Lock';
       }



    }


    startNetwork();
</script>

</body>
</html>
